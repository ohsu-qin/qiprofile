<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>build/src/subject/subject.component.ts - qiprofile API</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div class="yui3-g">
        <div id="sidebar" class="yui3-u">
            <div class="logo">
              <a href="../index.html">
                  qiprofile API
              </a>
            </div>
            
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../modules/clinical.html">clinical</a>
                            </li>
                            <li><a href="../modules/collection.html">collection</a>
                            </li>
                            <li><a href="../modules/collections.html">collections</a>
                            </li>
                            <li><a href="../modules/common.html">common</a>
                            </li>
                            <li><a href="../modules/configuration.html">configuration</a>
                            </li>
                            <li><a href="../modules/controls.html">controls</a>
                            </li>
                            <li><a href="../modules/data.html">data</a>
                            </li>
                            <li><a href="../modules/date.html">date</a>
                            </li>
                            <li><a href="../modules/error.html">error</a>
                            </li>
                            <li><a href="../modules/file.html">file</a>
                            </li>
                            <li><a href="../modules/home.html">home</a>
                            </li>
                            <li><a href="../modules/image.html">image</a>
                            </li>
                            <li><a href="../modules/imageSequence.html">imageSequence</a>
                            </li>
                            <li><a href="../modules/main.html">main</a>
                            </li>
                            <li><a href="../modules/modeling.html">modeling</a>
                            </li>
                            <li><a href="../modules/object.html">object</a>
                            </li>
                            <li><a href="../modules/page.html">page</a>
                            </li>
                            <li><a href="../modules/project.html">project</a>
                            </li>
                            <li><a href="../modules/projects.html">projects</a>
                            </li>
                            <li><a href="../modules/protocol.html">protocol</a>
                            </li>
                            <li><a href="../modules/rest.html">rest</a>
                            </li>
                            <li><a href="../modules/roman.html">roman</a>
                            </li>
                            <li><a href="../modules/session.html">session</a>
                            </li>
                            <li><a href="../modules/string.html">string</a>
                            </li>
                            <li><a href="../modules/subject.html">subject</a>
                            </li>
                            <li><a href="../modules/testing.html">testing</a>
                            </li>
                            <li><a href="../modules/visualization.html">visualization</a>
                            </li>
                            <li><a href="../modules/volume.html">volume</a>
                            </li>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/AppComponent.html">AppComponent</a></li>
                            <li><a href="../classes/AppModule.html">AppModule</a></li>
                            <li><a href="../classes/BooleanPipe.html">BooleanPipe</a></li>
                            <li><a href="../classes/Breast.html">Breast</a></li>
                            <li><a href="../classes/BreastNormalizedAssay.html">BreastNormalizedAssay</a></li>
                            <li><a href="../classes/BreastPathology.html">BreastPathology</a></li>
                            <li><a href="../classes/CapitalizePipe.html">CapitalizePipe</a></li>
                            <li><a href="../classes/CascadeSelectComponent.html">CascadeSelectComponent</a></li>
                            <li><a href="../classes/ChoicePipe.html">ChoicePipe</a></li>
                            <li><a href="../classes/ClinicalEncounter.html">ClinicalEncounter</a></li>
                            <li><a href="../classes/CollectionActivatedRouteStub.html">CollectionActivatedRouteStub</a></li>
                            <li><a href="../classes/CollectionComponent.html">CollectionComponent</a></li>
                            <li><a href="../classes/CollectionComponentSpec.html">CollectionComponentSpec</a></li>
                            <li><a href="../classes/CollectionItemComponent.html">CollectionItemComponent</a></li>
                            <li><a href="../classes/CollectionListPage.html">CollectionListPage</a></li>
                            <li><a href="../classes/CollectionListSpec.html">CollectionListSpec</a></li>
                            <li><a href="../classes/CollectionModule.html">CollectionModule</a></li>
                            <li><a href="../classes/CollectionRouterStub.html">CollectionRouterStub</a></li>
                            <li><a href="../classes/CollectionsActivatedRouteStub.html">CollectionsActivatedRouteStub</a></li>
                            <li><a href="../classes/CollectionsComponent.html">CollectionsComponent</a></li>
                            <li><a href="../classes/CollectionsComponentSpec.html">CollectionsComponentSpec</a></li>
                            <li><a href="../classes/CollectionsModule.html">CollectionsModule</a></li>
                            <li><a href="../classes/CollectionsResource.html">CollectionsResource</a></li>
                            <li><a href="../classes/CollectionsService.html">CollectionsService</a></li>
                            <li><a href="../classes/CollectionsServiceStub.html">CollectionsServiceStub</a></li>
                            <li><a href="../classes/CollectionSubectServiceStub.html">CollectionSubectServiceStub</a></li>
                            <li><a href="../classes/Color.html">Color</a></li>
                            <li><a href="../classes/ColorBarDirective.html">ColorBarDirective</a></li>
                            <li><a href="../classes/CommonModule.html">CommonModule</a></li>
                            <li><a href="../classes/ConfigurationService.html">ConfigurationService</a></li>
                            <li><a href="../classes/ConfigurationServiceSpec.html">ConfigurationServiceSpec</a></li>
                            <li><a href="../classes/ControlsModule.html">ControlsModule</a></li>
                            <li><a href="../classes/CorrelationComponent.html">CorrelationComponent</a></li>
                            <li><a href="../classes/DateHelper.html">DateHelper</a></li>
                            <li><a href="../classes/DateHelperSpec.html">DateHelperSpec</a></li>
                            <li><a href="../classes/Encounter.html">Encounter</a></li>
                            <li><a href="../classes/ErrorComponent.html">ErrorComponent</a></li>
                            <li><a href="../classes/ErrorHandler.html">ErrorHandler</a></li>
                            <li><a href="../classes/FileService.html">FileService</a></li>
                            <li><a href="../classes/FileServiceSpec.html">FileServiceSpec</a></li>
                            <li><a href="../classes/Findable.html">Findable</a></li>
                            <li><a href="../classes/FloorPipe.html">FloorPipe</a></li>
                            <li><a href="../classes/HomeComponent.html">HomeComponent</a></li>
                            <li><a href="../classes/IamgeSequenceService.html">IamgeSequenceService</a></li>
                            <li><a href="../classes/Image.html">Image</a></li>
                            <li><a href="../classes/ImageComponent.html">ImageComponent</a></li>
                            <li><a href="../classes/ImageModule.html">ImageModule</a></li>
                            <li><a href="../classes/ImageSequence.html">ImageSequence</a></li>
                            <li><a href="../classes/ImageSequenceServiceSpec.html">ImageSequenceServiceSpec</a></li>
                            <li><a href="../classes/ImageSequenceSessionServiceStub.html">ImageSequenceSessionServiceStub</a></li>
                            <li><a href="../classes/ImageSequenceSpec.html">ImageSequenceSpec</a></li>
                            <li><a href="../classes/ImageStore.html">ImageStore</a></li>
                            <li><a href="../classes/LabelMap.html">LabelMap</a></li>
                            <li><a href="../classes/Modeling.html">Modeling</a></li>
                            <li><a href="../classes/ModelingComponent.html">ModelingComponent</a></li>
                            <li><a href="../classes/ModelingModule.html">ModelingModule</a></li>
                            <li><a href="../classes/ModelingProtocolComponent.html">ModelingProtocolComponent</a></li>
                            <li><a href="../classes/ModelingResult.html">ModelingResult</a></li>
                            <li><a href="../classes/ModelingResults.html">ModelingResults</a></li>
                            <li><a href="../classes/ModelingSourceComponent.html">ModelingSourceComponent</a></li>
                            <li><a href="../classes/MomentPipe.html">MomentPipe</a></li>
                            <li><a href="../classes/ObjectHelper.html">ObjectHelper</a></li>
                            <li><a href="../classes/Page.html">Page</a></li>
                            <li><a href="../classes/PageComponent.html">PageComponent</a></li>
                            <li><a href="../classes/PageModule.html">PageModule</a></li>
                            <li><a href="../classes/PapayaService.html">PapayaService</a></li>
                            <li><a href="../classes/ParameterResult.html">ParameterResult</a></li>
                            <li><a href="../classes/Pathology.html">Pathology</a></li>
                            <li><a href="../classes/PlayerComponent.html">PlayerComponent</a></li>
                            <li><a href="../classes/ProjectItemComponent.html">ProjectItemComponent</a></li>
                            <li><a href="../classes/ProjectListPage.html">ProjectListPage</a></li>
                            <li><a href="../classes/ProjectListSpec.html">ProjectListSpec</a></li>
                            <li><a href="../classes/ProjectsComponent.html">ProjectsComponent</a></li>
                            <li><a href="../classes/ProjectsComponentSpec.html">ProjectsComponentSpec</a></li>
                            <li><a href="../classes/ProjectsModule.html">ProjectsModule</a></li>
                            <li><a href="../classes/ProjectsResource.html">ProjectsResource</a></li>
                            <li><a href="../classes/ProjectsService.html">ProjectsService</a></li>
                            <li><a href="../classes/ProjectsServiceStub.html">ProjectsServiceStub</a></li>
                            <li><a href="../classes/PropertyTableComponent.html">PropertyTableComponent</a></li>
                            <li><a href="../classes/ProtocolResource.html">ProtocolResource</a></li>
                            <li><a href="../classes/ProtocolService.html">ProtocolService</a></li>
                            <li><a href="../classes/RCB.html">RCB</a></li>
                            <li><a href="../classes/Registration.html">Registration</a></li>
                            <li><a href="../classes/RegistrationSpec.html">RegistrationSpec</a></li>
                            <li><a href="../classes/REST.html">REST</a></li>
                            <li><a href="../classes/RestResource.html">RestResource</a></li>
                            <li><a href="../classes/RESTSpec.html">RESTSpec</a></li>
                            <li><a href="../classes/Roman.html">Roman</a></li>
                            <li><a href="../classes/RomanSpec.html">RomanSpec</a></li>
                            <li><a href="../classes/Sarcoma.html">Sarcoma</a></li>
                            <li><a href="../classes/Scan.html">Scan</a></li>
                            <li><a href="../classes/ScanSpec.html">ScanSpec</a></li>
                            <li><a href="../classes/ScatterPlotDirective.html">ScatterPlotDirective</a></li>
                            <li><a href="../classes/Session.html">Session</a></li>
                            <li><a href="../classes/SessionActivatedRouteStub.html">SessionActivatedRouteStub</a></li>
                            <li><a href="../classes/SessionComponent.html">SessionComponent</a></li>
                            <li><a href="../classes/SessionComponentSpec.html">SessionComponentSpec</a></li>
                            <li><a href="../classes/SessionDetailResource.html">SessionDetailResource</a></li>
                            <li><a href="../classes/SessionDetailResourceStub.html">SessionDetailResourceStub</a></li>
                            <li><a href="../classes/SessiondRouterStub.html">SessiondRouterStub</a></li>
                            <li><a href="../classes/SessionModule.html">SessionModule</a></li>
                            <li><a href="../classes/SessionService.html">SessionService</a></li>
                            <li><a href="../classes/SessionServiceSpec.html">SessionServiceSpec</a></li>
                            <li><a href="../classes/SessionServiceStub.html">SessionServiceStub</a></li>
                            <li><a href="../classes/SessionSpec.html">SessionSpec</a></li>
                            <li><a href="../classes/SessionSubjectResourceStub.html">SessionSubjectResourceStub</a></li>
                            <li><a href="../classes/SessionTumorExtent.html">SessionTumorExtent</a></li>
                            <li><a href="../classes/SliderDirective.html">SliderDirective</a></li>
                            <li><a href="../classes/SparkLineDirective.html">SparkLineDirective</a></li>
                            <li><a href="../classes/StringHelper.html">StringHelper</a></li>
                            <li><a href="../classes/StringHelperSpec.html">StringHelperSpec</a></li>
                            <li><a href="../classes/Subject.html">Subject</a></li>
                            <li><a href="../classes/SubjectActivatedRouteStub.html">SubjectActivatedRouteStub</a></li>
                            <li><a href="../classes/SubjectChangeDetectorRefStub.html">SubjectChangeDetectorRefStub</a></li>
                            <li><a href="../classes/SubjectComponent.html">SubjectComponent</a></li>
                            <li><a href="../classes/SubjectComponentSpec.html">SubjectComponentSpec</a></li>
                            <li><a href="../classes/SubjectdRouterStub.html">SubjectdRouterStub</a></li>
                            <li><a href="../classes/SubjectModule.html">SubjectModule</a></li>
                            <li><a href="../classes/SubjectResource.html">SubjectResource</a></li>
                            <li><a href="../classes/SubjectResourceStub.html">SubjectResourceStub</a></li>
                            <li><a href="../classes/SubjectService.html">SubjectService</a></li>
                            <li><a href="../classes/SubjectServiceSpec.html">SubjectServiceSpec</a></li>
                            <li><a href="../classes/SubjectServiceStub.html">SubjectServiceStub</a></li>
                            <li><a href="../classes/SubjectSpec.html">SubjectSpec</a></li>
                            <li><a href="../classes/Symbol.html">Symbol</a></li>
                            <li><a href="../classes/Table.html">Table</a></li>
                            <li><a href="../classes/TimeLineDirective.html">TimeLineDirective</a></li>
                            <li><a href="../classes/TimeSeries.html">TimeSeries</a></li>
                            <li><a href="../classes/TNM.html">TNM</a></li>
                            <li><a href="../classes/Treatment.html">Treatment</a></li>
                            <li><a href="../classes/UnderscorePipe.html">UnderscorePipe</a></li>
                            <li><a href="../classes/UnspecifiedPipe.html">UnspecifiedPipe</a></li>
                            <li><a href="../classes/VisualizationModule.html">VisualizationModule</a></li>
                            <li><a href="../classes/Volume.html">Volume</a></li>
                            <li><a href="../classes/VolumeComponent.html">VolumeComponent</a></li>
                            <li><a href="../classes/VolumeDetailPage.html">VolumeDetailPage</a></li>
                            <li><a href="../classes/VolumeImageSequenceServiceStub.html">VolumeImageSequenceServiceStub</a></li>
                            <li><a href="../classes/VolumeModule.html">VolumeModule</a></li>
                            <li><a href="../classes/VolumeService.html">VolumeService</a></li>
                            <li><a href="../classes/VolumeServiceSpec.html">VolumeServiceSpec</a></li>
                            <li><a href="../classes/VolumeSpec.html">VolumeSpec</a></li>
                            <li><a href="../classes/XNAT.html">XNAT</a></li>
                            <li><a href="../classes/XNATSpec.html">XNATSpec</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div class="version-info">
              Version: 2.1.1
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><div class="title">
  <h1 class="file-name">build/src/subject/subject.component.ts</h1>
</div>

<pre class="code prettyprint linenums">
import * as _ from &#x27;lodash&#x27;;
import { Observable } from &#x27;rxjs&#x27;;
import {
  Component, ChangeDetectionStrategy, ChangeDetectorRef, HostListener
} from &#x27;@angular/core&#x27;;
import { Router, ActivatedRoute } from &#x27;@angular/router&#x27;;
import { NgbModal } from &#x27;@ng-bootstrap/ng-bootstrap&#x27;;

import ObjectHelper from &#x27;../common/object-helper.coffee&#x27;;
import {
  ConfigurationService
} from &#x27;../configuration/configuration.service.ts&#x27;;
import { PageComponent } from &#x27;../page/page.component.ts&#x27;;
import ImageStore from &#x27;../image/image-store.coffee&#x27;;
import Subject from &#x27;./subject.data.coffee&#x27;;
import { SubjectService } from &#x27;./subject.service.ts&#x27;;

/**
 * A time line clinical encounter is designated by the HTML
 * nabla special character (the wedge-like math del operator).
 *
 * @property WEDGE {string}
 * @private
 * @static
 */
const WEDGE = &#x27;\u2207&#x27;;

/**
 * The demographics properties.
 *
 * @property DEMOGRAPHICS_PROPERTIES {string[]}
 * @private
 * @static
 */
const DEMOGRAPHICS_PROPERTIES = [&#x27;age&#x27;, &#x27;gender&#x27;, &#x27;races&#x27;, &#x27;ethnicity&#x27;];

@Component({
  selector: &#x27;qi-subject&#x27;,
  templateUrl: &#x27;/public/html/subject/subject.html&#x27;,
  // Instruct Angular to disable change detection until this
  // component tells it to do so.
  changeDetection: ChangeDetectionStrategy.OnPush
})

/**
 * The Subject Detail page component.
 *
 * @class SubjectComponent
 */
export class SubjectComponent extends PageComponent {
  /**
   * The subject to display.
   *
   * @property subject {Object}
   */
  subject: Object;

  /**
   * The subject demographics sub-object.
   *
   * @property demographics {Object}
   */
  get demographics(): Object {
    return _.pick(this.subject, DEMOGRAPHICS_PROPERTIES);
  }

  /**
   * A
   * {{#crossLink &quot;SubjectComponent/getLabel&quot;}}{{/crossLink}}
   * wrapper that can be used in templates.
   *
   * @property label {function}
   */
  const label = property =&gt; this.getLabel(property);

  /**
   * The discrete property {path: {value: label}} tick label choices.
   *
   * @property valueChoices {Object}
   */
  valueChoices: Object;

  /**
   * The project name.
   *
   * @property project {string}
   * @readOnly
   */
  get project(): string  {
    return this.subject ? this.subject.project : null;
  }

  /**
   * The time line text is a wedge special symbol for a
   * clinical encounter, the session number otherwise.
   *
   * @property timeLineText {function}
   */
  timeLineText = (encounter: Object) =&gt; {
    return this._timeLineText(encounter);
  }

  /**
   * The
   * {{#crossLink &quot;SubjectComponent/subject:property&quot;}}{{/crossLink}}
   * encounters.
   *
   * @property encounters
   * @return {Object[]} the subject encounters
   */
  get encounters() {
    return _.get(this.subject, &#x27;encounters&#x27;);
  }

  /**
   * The time line class is the lower case dasherized REST
   * data object class.
   *
   * @property encounterDataClass {function}
   */
  encounterDataClass = (encounter: Object) =&gt; {
    return this._encounterDataClass(encounter);
  }

  /**
   * The
   * {{#crossLink &quot;TimeLineDirective/legend&quot;}}{{/crossLink}}
   * specification, consisting of the {_dataClass_: {label}}
   * settings for the encounter data classes. The
   * {{#crossLink &quot;TimeLineDirective/legend&quot;}}{{/crossLink}}
   * defaults suffice for all other legend settings.
   *
   * @property legend {Object}
   */
  get legend() {
    return this._legend();
  }

  /**
   * The
   * {{#crossLink &quot;SubjectComponent/subject:property&quot;}}{{/crossLink}}
   * treatments, ordered with the primary treatment first so that it
   * will overlay any overlapping neodajuvant or adjuvant treatment.
   *
   * @property treatments
   * @return {Object[]} the subject treatments
   */
  get treatments() {
    if (this.subject) {
      let isPrimary = trt =&gt; trt.treatmentType === &#x27;Primary&#x27;;
      let primary = _.find(this.subject.treatments, isPrimary);
      if (primary) {
        let others = _.without(this.subject.treatments, primary);
        return others.concat([primary]);
      } else {
        return this.subject.treatments;
      }
    }
  }

  /**
   * The comma-delimited
   * {{#crossLink &quot;SubjectComponent/subject:property&quot;}}{{/crossLink}}
   * clinical demographics, encounter and treatment HTML element ids.
   *
   * @property clinicalHtmlIdsSequence {string}
   */
  get clinicalHtmlIdsSequence(): string {
    let clnEncs = this.subject.clinicalEncounters;
    let clnEncIds = clnEncs.map(this.clinicalEncounterHtmlId);
    let treatmentId = (trt, i) =&gt; &#x27;treatment-&#x27; + (i + 1);
    let trtIds = this.subject.treatments.map(treatmentId);
    let dmg = _.isEmpty(this.demographics) ? [] : &#x27;demographics&#x27;;

    return _.flatten([dmg, clnEncIds, trtIds]).join(&#x27;, &#x27;);
  }

  /**
   * The time line width. Given the Subject page formatting,
   * this width is computed as 60% of the document body width.
   *
   * @property timeLineWidth {number}
   */
  timeLineWidth: number;

  constructor(
    private router: Router, private route: ActivatedRoute,
    modalService: NgbModal,
    subjectService: SubjectService,
    private configService: ConfigurationService,
    changeDetector: ChangeDetectorRef
  ) {
    super(modalService);

    // The route/query parameters.
    let params = this.route.params.value;

    // The select {path: {value: label}} configuration.
    this.valueChoices = this.configService.valueChoices;

    // A place-holder subject sufficient to get a title.
    this.subject = subjectService.secondaryKey(params);
    Subject.extend(this.subject);
    // Fetch the real subject.
    subjectService.getSubject(params).subscribe(subject =&gt; {
      if (subject) {
        this.subject = subject;
      } else {
        this.error = &#x60;${ this.subject.title } was not found&#x60;;
      }
      // Tell Angular to digest the change.
      changeDetector.markForCheck();
    });

    // The initial time line width.
    this.timeLineWidth = this.computeTimeLineWidth();
    // Recompute the time line width on resize.
    Observable.fromEvent(window, &#x27;resize&#x27;)
      .debounceTime(500)
      .subscribe((event) =&gt; {
        this.timeLineWidth = this.computeTimeLineWidth();
        // Tell Angular to digest the change.
        changeDetector.markForCheck();
      });
  }

  /**
   * Delegates to
   * {{#crossLink &quot;ConfigurationService/getHTMLLabel&quot;}}{{/crossLink}},
   *
   * @method getLabel
   * @param property {string} the property path
   * @return {string} the display HTML label
   */
  getLabel(property: string): string {
    return this.configService.getHTMLLabel(property, this.subject.collection);
  }

  /**
   * @method clinicalEncounterHtmlId
   * @param encounter {Object} the encounter object
   * @param index {number} the clinical encounter array index
   * @return {string} the encounter _title_-_index_ HTML id
   */
  clinicalEncounterHtmlId(encounter: Object, index: number): string {
    return encounter.title.toLowerCase() + &#x27;-&#x27; + (index + 1);
  }

  /**
   * Delegates to
   * {{#crossLink &quot;ObjectHelper/hasValidContent&quot;}}{{/crossLink}}.
   *
   * @method has
   * @param value {any} the value to check
   * @return {boolean} whether the value has displayable content
   */
  has(value: any): boolean {
    return ObjectHelper.hasValidContent(value);
  }

  /**
   * @method hasDemographics
   * @return {boolean} whether there is at least one non-empty
   *   {{#crossLink &quot;SubjectComponent/demographics:property&quot;}}{{/crossLink}}
   *   property value
   */
  hasDemographics(): boolean {
    return !_.isEmpty(this.demographics);
  }

  /**
   * Returns the image {{#crossLink &quot;ImageStore&quot;}}{{/crossLink}}
   * file location.
   *
   * @method location
   * @param image {Image} the image object
   * @return {string} the server image file path relative to the server
   *   web app root
   */
  location(image: Object): string {
    return ImageStore.location(image);
  }

  /**
   * Opens the Session Detail page.
   *
   * @method visitSession
   * @param session {Object} the session REST object
   */
  visitSession(session: Object) {
    // For now, go directly to the scan display.
    // TODO - navigate to an intermediate Session Detail page.
    this.router.navigate(
      [&#x27;session&#x27;, session.number, &#x27;scan&#x27;, 1, &#x27;volumes&#x27;],
      {relativeTo: this.route}
    );
  }

  /**
   * The time line is 60% as wide as the document body
   * above the small device responsive breakpoint, 90%
   * below. The small device breakpoint is 768 per
   * the [Bootstrap CSS guide](http://getbootstrap.com/css/).
   *
   * @method computeTimeLineWidth
   * @private
   * @returns {number} the time line width
   */
  private computeTimeLineWidth(): number {
    // The body has a 4-point horizontal padding below the
    // breakpoint.
    const BREAKPOINT = 768 - 8;
    let rect = document.body.getBoundingClientRect();
    let isCollapsed = rect.width &lt; BREAKPOINT;
    let factor = isCollapsed ? 0.9 : 0.6;
    return Math.floor(rect.width * factor);
  }

  /**
   * @method _timeLineText
   * @param encounter {Object} the encounter REST data object
   * @return {string} the SVG text element inner text string
   */
  private _timeLineText(encounter: Object): string  {
    return encounter.isClinical() ? WEDGE : encounter.number;
  }

  /**
   * @method _encounterDataClass
   * @private
   * @param encounter {Object} the encounter REST data object
   * @return {string} the data class
   */
  private _encounterDataClass(encounter: Object): string {
    let klass = encounter._cls;
    // Left-truncate the surgery specialization class names.
    if (klass.endsWith(&#x27;Surgery&#x27;)) {
      klass = &#x27;Surgery&#x27;;
    }
    return klass;
  }

  /**
   * Returns the
   * {{#crossLink &quot;SubjectComponent/legend:property&quot;}}{{/crossLink}}
   * specification.
   *
   * @method _legend
   * @private
   * @return {Object} the legend specification
   */
  private _legend() {
    // The clinical encounters ordered by date.
    let clnEncounters = _.sortBy(this.subject.clinicalEncounters, &#x27;date&#x27;);
    // The encounter data classes.
    let clnCasses = _.uniq(clnEncounters.map(this.encounterDataClass));
    // The clinical legend label is the wedge character.
    let accumClinicalLegends = (accum, dataClass) =&gt; {
      accum[dataClass] = {label: WEDGE};
    };
    let legends = _.transform(clnCasses, accumClinicalLegends, {});

    // The session legend label is the session number range.
    legends[&#x27;Session&#x27;] = {
      label: &#x60;1-${ this.subject.sessions.length }&#x60;,
      name: &#x27;Imaging Visit&#x27;
    };

    return legends;
  }
}

</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
</body>
</html>
