<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>build/src/configuration/configuration.service.ts - qiprofile API</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div class="yui3-g">
        <div id="sidebar" class="yui3-u">
            <div class="logo">
              <a href="../index.html">
                  qiprofile API
              </a>
            </div>
            
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../modules/clinical.html">clinical</a>
                            </li>
                            <li><a href="../modules/collection.html">collection</a>
                            </li>
                            <li><a href="../modules/collections.html">collections</a>
                            </li>
                            <li><a href="../modules/common.html">common</a>
                            </li>
                            <li><a href="../modules/configuration.html">configuration</a>
                            </li>
                            <li><a href="../modules/controls.html">controls</a>
                            </li>
                            <li><a href="../modules/data.html">data</a>
                            </li>
                            <li><a href="../modules/date.html">date</a>
                            </li>
                            <li><a href="../modules/error.html">error</a>
                            </li>
                            <li><a href="../modules/file.html">file</a>
                            </li>
                            <li><a href="../modules/help.html">help</a>
                            </li>
                            <li><a href="../modules/home.html">home</a>
                            </li>
                            <li><a href="../modules/image.html">image</a>
                            </li>
                            <li><a href="../modules/imageSequence.html">imageSequence</a>
                            </li>
                            <li><a href="../modules/main.html">main</a>
                            </li>
                            <li><a href="../modules/object.html">object</a>
                            </li>
                            <li><a href="../modules/page.html">page</a>
                            </li>
                            <li><a href="../modules/project.html">project</a>
                            </li>
                            <li><a href="../modules/projects.html">projects</a>
                            </li>
                            <li><a href="../modules/rest.html">rest</a>
                            </li>
                            <li><a href="../modules/roman.html">roman</a>
                            </li>
                            <li><a href="../modules/session.html">session</a>
                            </li>
                            <li><a href="../modules/string.html">string</a>
                            </li>
                            <li><a href="../modules/subject.html">subject</a>
                            </li>
                            <li><a href="../modules/testing.html">testing</a>
                            </li>
                            <li><a href="../modules/visualization.html">visualization</a>
                            </li>
                            <li><a href="../modules/volume.html">volume</a>
                            </li>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/AppComponent.html">AppComponent</a></li>
                            <li><a href="../classes/AppModule.html">AppModule</a></li>
                            <li><a href="../classes/Breast.html">Breast</a></li>
                            <li><a href="../classes/BreastNormalizedAssay.html">BreastNormalizedAssay</a></li>
                            <li><a href="../classes/BreastPathology.html">BreastPathology</a></li>
                            <li><a href="../classes/CascadeSelectComponent.html">CascadeSelectComponent</a></li>
                            <li><a href="../classes/ClinicalEncounter.html">ClinicalEncounter</a></li>
                            <li><a href="../classes/CollectionActivatedRouteStub.html">CollectionActivatedRouteStub</a></li>
                            <li><a href="../classes/CollectionComponent.html">CollectionComponent</a></li>
                            <li><a href="../classes/CollectionComponentSpec.html">CollectionComponentSpec</a></li>
                            <li><a href="../classes/CollectionItemComponent.html">CollectionItemComponent</a></li>
                            <li><a href="../classes/CollectionListPage.html">CollectionListPage</a></li>
                            <li><a href="../classes/CollectionListSpec.html">CollectionListSpec</a></li>
                            <li><a href="../classes/CollectionModule.html">CollectionModule</a></li>
                            <li><a href="../classes/CollectionRouterStub.html">CollectionRouterStub</a></li>
                            <li><a href="../classes/CollectionsActivatedRouteStub.html">CollectionsActivatedRouteStub</a></li>
                            <li><a href="../classes/CollectionsComponent.html">CollectionsComponent</a></li>
                            <li><a href="../classes/CollectionsComponentSpec.html">CollectionsComponentSpec</a></li>
                            <li><a href="../classes/CollectionsHelpComponent.html">CollectionsHelpComponent</a></li>
                            <li><a href="../classes/CollectionsHelpServiceStub.html">CollectionsHelpServiceStub</a></li>
                            <li><a href="../classes/CollectionsHelpTextComponent.html">CollectionsHelpTextComponent</a></li>
                            <li><a href="../classes/CollectionsModule.html">CollectionsModule</a></li>
                            <li><a href="../classes/CollectionsResource.html">CollectionsResource</a></li>
                            <li><a href="../classes/CollectionsService.html">CollectionsService</a></li>
                            <li><a href="../classes/CollectionsServiceStub.html">CollectionsServiceStub</a></li>
                            <li><a href="../classes/CollectionSubectServiceStub.html">CollectionSubectServiceStub</a></li>
                            <li><a href="../classes/ColorBarDirective.html">ColorBarDirective</a></li>
                            <li><a href="../classes/CommonModule.html">CommonModule</a></li>
                            <li><a href="../classes/ConfigurationService.html">ConfigurationService</a></li>
                            <li><a href="../classes/ConfigurationServiceSpec.html">ConfigurationServiceSpec</a></li>
                            <li><a href="../classes/ControlsModule.html">ControlsModule</a></li>
                            <li><a href="../classes/CorrelationComponent.html">CorrelationComponent</a></li>
                            <li><a href="../classes/DateHelper.html">DateHelper</a></li>
                            <li><a href="../classes/DateHelperSpec.html">DateHelperSpec</a></li>
                            <li><a href="../classes/Encounter.html">Encounter</a></li>
                            <li><a href="../classes/ErrorComponent.html">ErrorComponent</a></li>
                            <li><a href="../classes/FileService.html">FileService</a></li>
                            <li><a href="../classes/FileServiceSpec.html">FileServiceSpec</a></li>
                            <li><a href="../classes/Findable.html">Findable</a></li>
                            <li><a href="../classes/HelpComponent.html">HelpComponent</a></li>
                            <li><a href="../classes/HelpService.html">HelpService</a></li>
                            <li><a href="../classes/HomeComponent.html">HomeComponent</a></li>
                            <li><a href="../classes/IamgeSequenceService.html">IamgeSequenceService</a></li>
                            <li><a href="../classes/Image.html">Image</a></li>
                            <li><a href="../classes/ImageComponent.html">ImageComponent</a></li>
                            <li><a href="../classes/ImageModule.html">ImageModule</a></li>
                            <li><a href="../classes/ImageSequence.html">ImageSequence</a></li>
                            <li><a href="../classes/ImageSequenceServiceSpec.html">ImageSequenceServiceSpec</a></li>
                            <li><a href="../classes/ImageSequenceSessionServiceStub.html">ImageSequenceSessionServiceStub</a></li>
                            <li><a href="../classes/ImageSequenceSpec.html">ImageSequenceSpec</a></li>
                            <li><a href="../classes/ImageStore.html">ImageStore</a></li>
                            <li><a href="../classes/LabelMap.html">LabelMap</a></li>
                            <li><a href="../classes/Modeling.html">Modeling</a></li>
                            <li><a href="../classes/ModelingResult.html">ModelingResult</a></li>
                            <li><a href="../classes/ModelingResults.html">ModelingResults</a></li>
                            <li><a href="../classes/ObjectHelper.html">ObjectHelper</a></li>
                            <li><a href="../classes/Page.html">Page</a></li>
                            <li><a href="../classes/PageComponent.html">PageComponent</a></li>
                            <li><a href="../classes/PageModule.html">PageModule</a></li>
                            <li><a href="../classes/PapayaService.html">PapayaService</a></li>
                            <li><a href="../classes/ParameterResult.html">ParameterResult</a></li>
                            <li><a href="../classes/Pathology.html">Pathology</a></li>
                            <li><a href="../classes/PlayerComponent.html">PlayerComponent</a></li>
                            <li><a href="../classes/ProjectItemComponent.html">ProjectItemComponent</a></li>
                            <li><a href="../classes/ProjectListPage.html">ProjectListPage</a></li>
                            <li><a href="../classes/ProjectListSpec.html">ProjectListSpec</a></li>
                            <li><a href="../classes/ProjectsComponent.html">ProjectsComponent</a></li>
                            <li><a href="../classes/ProjectsComponentSpec.html">ProjectsComponentSpec</a></li>
                            <li><a href="../classes/ProjectsHelpComponent.html">ProjectsHelpComponent</a></li>
                            <li><a href="../classes/ProjectsHelpServiceStub.html">ProjectsHelpServiceStub</a></li>
                            <li><a href="../classes/ProjectsHelpTextComponent.html">ProjectsHelpTextComponent</a></li>
                            <li><a href="../classes/ProjectsModule.html">ProjectsModule</a></li>
                            <li><a href="../classes/ProjectsResource.html">ProjectsResource</a></li>
                            <li><a href="../classes/ProjectsService.html">ProjectsService</a></li>
                            <li><a href="../classes/ProjectsServiceStub.html">ProjectsServiceStub</a></li>
                            <li><a href="../classes/PropertyTableComponent.html">PropertyTableComponent</a></li>
                            <li><a href="../classes/RCB.html">RCB</a></li>
                            <li><a href="../classes/Registration.html">Registration</a></li>
                            <li><a href="../classes/RegistrationSpec.html">RegistrationSpec</a></li>
                            <li><a href="../classes/REST.html">REST</a></li>
                            <li><a href="../classes/RestResource.html">RestResource</a></li>
                            <li><a href="../classes/RESTSpec.html">RESTSpec</a></li>
                            <li><a href="../classes/Roman.html">Roman</a></li>
                            <li><a href="../classes/RomanSpec.html">RomanSpec</a></li>
                            <li><a href="../classes/Sarcoma.html">Sarcoma</a></li>
                            <li><a href="../classes/Scan.html">Scan</a></li>
                            <li><a href="../classes/ScanSpec.html">ScanSpec</a></li>
                            <li><a href="../classes/ScatterPlotDirective.html">ScatterPlotDirective</a></li>
                            <li><a href="../classes/Session.html">Session</a></li>
                            <li><a href="../classes/SessionActivatedRouteStub.html">SessionActivatedRouteStub</a></li>
                            <li><a href="../classes/SessionComponent.html">SessionComponent</a></li>
                            <li><a href="../classes/SessionComponentSpec.html">SessionComponentSpec</a></li>
                            <li><a href="../classes/SessionDetailResource.html">SessionDetailResource</a></li>
                            <li><a href="../classes/SessionDetailResourceStub.html">SessionDetailResourceStub</a></li>
                            <li><a href="../classes/SessiondRouterStub.html">SessiondRouterStub</a></li>
                            <li><a href="../classes/SessionModule.html">SessionModule</a></li>
                            <li><a href="../classes/SessionService.html">SessionService</a></li>
                            <li><a href="../classes/SessionServiceSpec.html">SessionServiceSpec</a></li>
                            <li><a href="../classes/SessionServiceStub.html">SessionServiceStub</a></li>
                            <li><a href="../classes/SessionSpec.html">SessionSpec</a></li>
                            <li><a href="../classes/SessionSubjectResourceStub.html">SessionSubjectResourceStub</a></li>
                            <li><a href="../classes/SessionTumorExtent.html">SessionTumorExtent</a></li>
                            <li><a href="../classes/SliderDirective.html">SliderDirective</a></li>
                            <li><a href="../classes/SparkLineDirective.html">SparkLineDirective</a></li>
                            <li><a href="../classes/StringHelper.html">StringHelper</a></li>
                            <li><a href="../classes/StringHelperSpec.html">StringHelperSpec</a></li>
                            <li><a href="../classes/Subject.html">Subject</a></li>
                            <li><a href="../classes/SubjectActivatedRouteStub.html">SubjectActivatedRouteStub</a></li>
                            <li><a href="../classes/SubjectChangeDetectorRefStub.html">SubjectChangeDetectorRefStub</a></li>
                            <li><a href="../classes/SubjectComponent.html">SubjectComponent</a></li>
                            <li><a href="../classes/SubjectComponentSpec.html">SubjectComponentSpec</a></li>
                            <li><a href="../classes/SubjectdRouterStub.html">SubjectdRouterStub</a></li>
                            <li><a href="../classes/SubjectModule.html">SubjectModule</a></li>
                            <li><a href="../classes/SubjectResource.html">SubjectResource</a></li>
                            <li><a href="../classes/SubjectResourceStub.html">SubjectResourceStub</a></li>
                            <li><a href="../classes/SubjectService.html">SubjectService</a></li>
                            <li><a href="../classes/SubjectServiceSpec.html">SubjectServiceSpec</a></li>
                            <li><a href="../classes/SubjectServiceStub.html">SubjectServiceStub</a></li>
                            <li><a href="../classes/SubjectSpec.html">SubjectSpec</a></li>
                            <li><a href="../classes/Table.html">Table</a></li>
                            <li><a href="../classes/TimeSeries.html">TimeSeries</a></li>
                            <li><a href="../classes/TNM.html">TNM</a></li>
                            <li><a href="../classes/ToggleHelpComponent.html">ToggleHelpComponent</a></li>
                            <li><a href="../classes/VisualizationModule.html">VisualizationModule</a></li>
                            <li><a href="../classes/Volume.html">Volume</a></li>
                            <li><a href="../classes/VolumeComponent.html">VolumeComponent</a></li>
                            <li><a href="../classes/VolumeDetailPage.html">VolumeDetailPage</a></li>
                            <li><a href="../classes/VolumeImageSequenceServiceStub.html">VolumeImageSequenceServiceStub</a></li>
                            <li><a href="../classes/VolumeModule.html">VolumeModule</a></li>
                            <li><a href="../classes/VolumeService.html">VolumeService</a></li>
                            <li><a href="../classes/VolumeServiceSpec.html">VolumeServiceSpec</a></li>
                            <li><a href="../classes/VolumeSpec.html">VolumeSpec</a></li>
                            <li><a href="../classes/XNAT.html">XNAT</a></li>
                            <li><a href="../classes/XNATSpec.html">XNATSpec</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div class="version-info">
              Version: 2.1.1
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><div class="title">
  <h1 class="file-name">build/src/configuration/configuration.service.ts</h1>
</div>

<pre class="code prettyprint linenums">
/**
 * The application configuration module.
 *
 * @module configuration
 * @main configuration
 */

import * as _ from &#x27;lodash&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;
import { parse } from &#x27;ini-parser&#x27;;

import StringHelper from &#x27;../string/string-helper.coffee&#x27;;
import dataModelInput from &#x27;./data-model.cfg&#x27;;
import valueChoicesInput from &#x27;./value-choices.cfg&#x27;;
import preferencesInput from &#x27;./preferences.cfg&#x27;;

@Injectable()

/**
 * The application configuration service.
 *
 * @class ConfigurationService
 */
export class ConfigurationService {
  /**
   * The preferences configuration object.
   *
   * @property preferences {Object}
   */
  preferences: Object;

  /**
   * The choices configuration {path: {value: label}} object,
   * where *path* is the property select choice path.
   *
   * @property valueChoices {Object}
   */
  valueChoices: Object;

  /**
   * The data model configuration object. This input is
   * parsed into the
   * {{#crossLink &quot;ConfigurationService/labelLookup:property&quot;}}{{/crossLink}}
   * for use by
   * {{#crossLink &quot;ConfigurationService/getLabel&quot;}}{{/crossLink}}.
   *
   * @property dataModel {Object}
   */
  dataModel: Object;

  /**
   * The application data model configuration object built
   * from the &#x60;data_model.cfg&#x60; input file. The input file
   * topics are conceptual objects. The input sections
   * assign a property path to a label, e.g. the section:
   *
   *     [Demographics]
   *     Age = age
   *
   * specifies that a Demographics object has the property
   * *age* with display label &#x60;Age&#x60;.
   *
   * A topic can be parameterized by a qualifier, e.g. the topic:
   *
   *     [Pathology&lt;Breast&gt;]
   *
   * pertains only to the &#x60;Breast&#x60; qualifier. Only topics
   * can be parameterized.
   *
   * The property value &#x60;this&#x60; is a logical aggregation, e.g.
   * the section:
   *
   *     [RCB]
   *     RCB Summary = this
   *     RCB Detail = this
   *
   * groups the RCB object into two logical aggregations.
   *
   * An atomic property entry, i.e. an entry that does not
   * refer to another topic, can be annotated by an HTML label,
   * e.g. the entry:
   *
   *     tau_i = tauI (&amp;tau;&lt;sub&gt;i&lt;/sub&gt;)
   *
   * specifies that the *tauI* property has text label &#x60;tau_i&#x60;
   * with HTML representation &amp;tau;&lt;sub&gt;i&lt;/sub&gt;.
   *
   * The file is parsed into this
   * {{#crossLink &quot;ConfigurationService/dataModel:property&quot;}}{{/crossLink}}.
   * The parsed object consists of {context: config} properties,
   * where *context* is &#x60;common&#x60; for the shared data model or a
   * parameterized qualifier as described above, and *config*
   * is the parsed configuration for that context.
   *
   * Each parsed configuration is a
   * {topic: {property: {_label, child...}}}
   * associative label lookup object, where *_label* is a
   * {&#x60;text&#x60;, &#x60;html&#x60;} label object and *child* is a child
   * property.
   *
   * Every object has a label but only non-atomic properties
   * have child properties. This sets up the convenient label
   * lookup configs for the common and extension configurations
   * as sketched in the following function:
   *
   *     (topic, path) =&gt; _.get(config, &#x60;${topic}.${path}.${_label}&#x60;)
   *
   * @example
   *     [Clinical]
   *     Demographics = subject
   *     Biopsy = subject.biopsy
   *
   *     [Demographics]
   *     Age = age
   *
   *     [Biopsy]
   *     Pathology = pathology
   *
   *     [Pathology]
   *     PrimaryTumor = tumors[0]
   *
   *     [PrimaryTumor]
   *     TNM = tnm
   *
   *     [PrimaryTumor&lt;Breast&gt;]
   *     RCB = rcb
   *
   *     [TNM]
   *     TNM Size = size.tumorSize
   *     ...
   *
   *  is parsed to:
   *
   *     {
   *       common:
   *         subject: {
   *           _label: {text: &#x27;Demographics&#x27;},
   *           age: {_label: {text: &#x27;Age&#x27;}},
   *           biopsy: {
   *             _label: {text: &#x27;Biopsy&#x27;},
   *             pathology: {
   *               _label: {text: &#x27;Pathology&#x27;},
   *               tumors: [
   *                 {
   *                   _label: {text: &#x27;Primary Tumor&#x27;},
   *                   tnm: {
   *                     _label: {text: &#x27;TNM&#x27;},
   *                     size: {
   *                       tumorSize: {_label: {text: &#x27;TNM Size&#x27;}},
   *                       ...
   *                     }
   *                   }
   *                 }
   *               ]
   *             }
   *           }
   *         }
   *       }
   *       Breast: {
   *         ... // same as common with the following exception:
   *                 tumors: [
   *                   {
   *                     _label: ...
   *                     tnm: ...
   *                     rcb: ...   // &lt;== breast-specific
   *       }
   *     }
   *
   * This example has a parameterized extension &#x60;Breast&#x60;
   * which augments the common configuration with breast
   * patient specializations. Note that each section topic
   * and section entry parses to a &#x60;_label property, but
   * the atomic property items only contain this &#x60;_label&#x60;
   * property. Label lookups are then a matter of calling
   * the lodash &#x60;_get&#x60; function with an augmented property
   * path. For example, the path:
   *
   *     common.Clinical.subject.biopsy.pathology.tumors[0].tnm.size.tumorSize._label.text
   *
   * resolves to &#x60;TNM Size&#x60; as described in
   * {{#crossLink &quot;ConfigurationService/getLabel&quot;}}{{/crossLink}}.
   *
   * Note that an array index is supported, e.g. &#x60;tumors[0]&#x60;
   * in the above example.
   *
   * @property dataModel {Object}
   */
  get labelLookup(): Object {
    // Parse on demand.
    if (!this._labelLookup) {
      this._labelLookup = this.parseDataModel();
    }
    return this._labelLookup;
  }

  /**
   * The parsed
   * {{#crossLink &quot;ConfigurationService/dataModel:property&quot;}}{{/crossLink}}
   * configuration object built on demand.
   *
   * @property _labelLookup {Object}
   * @private
   */
  private _labelLookup: Object;

  constructor() {
    this.preferences = parse(preferencesInput);
    this.valueChoices = parse(valueChoicesInput);
    this.dataModel = parse(dataModelInput);
  }

  /**
   * Returns the HTML label for the given display property.
   * The HTML label is determined as described in
   * {{#crossLink &quot;ConfigurationService/getTextLabel&quot;}}{{/crossLink}},
   * with the following difference:
   * * If the label lookup search returns a matching {text, html} label
   *   object and has a *html* value, then that value is returned.
   *
   * @method getHTMLLabel
   * @param property {string} the property path
   * @param config {string} the optional parameterized extension
   * @return {string} the display HTML label
   */
  getHTMLLabel(property: string, config?: string) {
    let target = this.getLabelObject(property, config);
    if (target) {
      return target.html || target.text;
    } else {
      return this.defaultLabel(property);
    }
  }

  /**
   * Returns the HTML label for the given display property.
   * The text label is determined as follows:
   * * If the label lookup search returns a matching {text, html}
   *   label object, then the *text* value is returned.
   * * If the search fails, then this method delegates to
   *   {{#crossLink &quot;ConfigurationService/defaultLabel&quot;}}{{/crossLink}}.
   *
   * @method getTextLabel
   * @param property {string} the property path
   * @param config {string} the optional parameterized extension
   * @return {string} the display text label
   */
  getTextLabel(property: string, config?: string) {
    let target = this.getLabelObject(property, config);
    if (target) {
      return target.text;
    } else {
      return this.defaultLabel(property);
    }
  }

  /**
   * Returns the {text, html} label object for the given display property.
   * The label is searched as described in
   * {{#crossLink &quot;ConfigurationService/getLabel&quot;}}{{/crossLink}}.
   *
   * If the label lookup search returns a matching {text, html} label object, then
   * the *html* value is returned, if it exists, otherwise the
   * *text* value is returned. If the search fails, then this method
   * delegates to
   * {{#crossLink &quot;StringHelper/labelize&quot;}}{{/crossLink}}.
   *
   * @method getLabel
   * @param property {string} the property path
   * @param config {string} the optional parameterized extension
   * @return {Object} the configured label object, if it exists,
   *   otherwise &#x60;undefined&#x60;
   */
  private getLabelObject(property: string, config?: string) {
    // The default config is common.
    if (!config || !(config in this.labelLookup)) {
      config = &#x27;common&#x27;;
    }
    // Augment the property path.
    let path = &#x60;${ config }.${ property }._label&#x60;;

    return _.get(this.labelLookup, path);
  }

  /**
   * If the label path contains &#x60;normalizedAssay&#x60;, then
   * this method delegates to
   * {{#crossLink &quot;StringHelper/labelize&quot;}}{{/crossLink}}
   * called on the terminal property name in the *property*
   * path.
   *
   * @method defaultLabel
   * @private
   * @param property {string} the property path
   * @return {string} the target label
   */
  private defaultLabel(property: string): string {
    const ASSAY = &#x27;normalizedAssay&#x27;;
    let last = _.last(property.split(&#x27;.&#x27;));
    if (_.includes(property, ASSAY)) {
      return this.defaultGenomicsLabel(last);
    } else {
      return StringHelper.labelize(last);
    }
  }

  /**
   * Returns the label for the given genomics property.
   * This method specializes
   * {{#crossLink &quot;ConfigurationService/defaultLabel&quot;}}{{/crossLink}}
   * for a property name of length six or less to upper-case.
   *
   * @example
   *     &#x27;er&#x27;  =&gt; &#x27;ER&#x27;
   *     &#x27;scube2&#x27;  =&gt; &#x27;SCUBE2&#x27;
   *     &#x27;survivin&#x27;  =&gt; &#x27;Survivin&#x27;
   *
   * @method defaultGenomicsLabel
   * @private
   * @param property {string} the property name (not path)
   * @return {string} the default label
   */
  private defaultGenomicsLabel(property: string): string {
    if (property.length &lt; 7) {
      return property.toUpperCase();
    } else {
      return StringHelper.labelize(property);
    }
  }

  /**
   * Converts the data model configuration input file into
   * the configuration object as described in
   * {{#crossLink &quot;ConfigurationService/labelLookup:property&quot;}}{{/crossLink}}.
   *
   * @method parseDataModel
   * @private
   * @return {Object} the parsed data model object
   */
  private parseDataModel() {
    // Convert {key: value} to {property: {_label}} for an
    // atomic property, {property: key} otherwise.
    let accumSwizzled = (accum, value, key) =&gt; {
      // Parse the entry.
      let [prop, html] = this.parseDataModelValue(value, key);
      if (key in this.dataModel) {
        if (prop === &#x27;this&#x27;) {
          let aggregation = this.dataModel[key];
          let aggregate = _.partial(accumSwizzled, accum);
          _.forEach(aggregation, aggregate);
        } else {
          let path = &#x60;${ prop }._include&#x60;;
          _.set(accum, path, key);
        }
      } else {
        // The atomic property target is the label.
        let target = {_label: {text: key, html: html}};
        _.set(accum, prop, target);
      }
    };
    let swizzle = section =&gt; _.transform(section, accumSwizzled, {});
    let swizzled = _.mapValues(this.dataModel, swizzle, {});

    // Separate the common data model from the parameterized
    // extensions.
    let common = {};
    let extensions = {};
    // Partition the input configuration into the common and
    // extension configurations.
    let partition = (section, topic) =&gt; {
      let [baseTopic, qualifier] = this.parseDataModelKey(topic);
      if (qualifier) {
        let extension = extensions[qualifier];
        if (!extension) {
          extension = extensions[qualifier] = {};
        }
        extension[baseTopic] = section;
      } else {
        common[topic] = section;
      }
    };
    _.forEach(swizzled, partition);

    // Merge the common into each extension.
    let mergeExtension = extension =&gt; {
      _.merge(extension, common);
    };
    _.forEach(extensions, mergeExtension);

    // Replace topic references with the referenced sections.
    let dereference = (config) =&gt; {
      let derefSection = (value, key, section) =&gt; {
        if (key === &#x27;_include&#x27;) {
          // The config can be common or an extension.
          // If the config is an extension, then the
          // extension override is preferred. Otherwise,
          // fall back on the common.
          let ref = config[value] || common[value];
          if (!ref) {
            // Should never happen by the partition
            // construction above.
            throw new Error(&#x27;The data model configuration reference&#x27; +
                            &#x60; was not found: ${ value }&#x60;);
          }
          // Add the label to the included section, if necessary.
          if (!ref._label) {
            ref._label = {text: value};
          }
          // Replace the value with the referenced section.
          _.assign(section, ref);
          // Delete the _include marker.
          delete section._include;
        } else if (key !== &#x27;_label&#x27;) {
          // Recurse.
          _.forEach(value, derefSection);
        }
      };

      _.forEach(config, derefSection);
    };
    dereference(common);
    _.forEach(extensions, dereference);

    // The top-level entries are not referenced by another entry.
    // Note that we check the entire input, i.e. both common and
    // extensions, for a child, since a child might be referenced
    // only in an extension.
    let isChild = topic =&gt;
      _.find(this.dataModel, other =&gt; topic in other);
    // The entry points into the config hierarchy are the
    // unreferenced topics. The look-up object is thus the
    // values of these entry points.
    let topTopics = _.reject(_.keys(common), isChild);
    let consolidate = config =&gt; {
      let top = _.pick(config, topTopics);
      return _.assign({}, ..._.values(top));
    };
    let configs = _.assign({common: common}, extensions);
    let consolidated = _.mapValues(configs, consolidate);

    return consolidated;
  }

  private parseDataModelKey(topic: string): string {
    let match = topic.match(/([\w\s]+)(&lt;(\w+)&gt;)?/);
    if (!match) {
      throw new Error(&#x27;Invalid data model configuration topic:&#x27; +
                      &#x60; ${ topic }&#x60;);
    }
    let [ , baseTopic, , qualifier] = match;
    return [baseTopic, qualifier];
  }

  /**
   * Converts the given data model configuration value into a
   * [property, html] pair. The input value must be a property
   * path optionally followed by a html qualifier.
   *
   * @example
   *     &#x27;c&#x27;                     =&gt;  [&#x27;c&#x27;, undefined]
   *     &#x27;c.d.e&#x27;                 =&gt;  [&#x27;c.d.e&#x27;, undefined]
   *     &#x27;c.vI (v&lt;sub&gt;i&lt;/sub&gt;)&#x27;  =&gt;  [&#x27;c.vI&#x27;, &#x27;v&lt;sub&gt;i&lt;/sub&gt;&#x27;]
   *     &#x27;c.d.e[0]&#x27;  =&gt;  [&#x27;c.d.e[0]&#x27;, undefined]
   *
   * @method parseDataModelValue
   * @private
   * @param value {string} the input data model item value
   * @return {string[]} the parsed item [property, html] pair
   */
  private parseDataModelValue(value, key) {
    // The config value might be qualified by a HTML label.
    // The match looks for a property path optionally followed
    // by a html qualifier, as described in the method api doc.
    const pat = /((\w+(\[\d+\])?\.)*(\w+(\[\d+\])?))\s*(\((.+)\))?$/;
    let match = value.match(pat);
    if (!match) {
      throw new Error(&#x27;Invalid data model configuration entry: &#x27; +
                      &#x60;${ key} = ${ value}&#x60;);
    }
    // The last property in the property path is the second
    // match group (third match array item), since we ignore
    // the (possibly empty) path prefix first match group.
    // The html is the fourth match group, if such exists.
    let prop = match[1];
    let html = _.last(match);

    return [prop, html];
  }
}

</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
</body>
</html>
